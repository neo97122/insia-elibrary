<?xml version="1.0" encoding="utf-8"?>
<mx:Canvas xmlns:mx="http://www.adobe.com/2006/mxml" initialize="{initCanvas();}">

    <mx:XMLList id="users">
        <user>
            <userId>1</userId>
            <userLogin>DanyTomato</userLogin>
            <userPassword>secret</userPassword>
            <userName>Lao</userName>
            <userFirstName>Daniel</userFirstName>
            <userMail>laodaniel@gmail.com</userMail>
            <userAdmin>true</userAdmin>
        </user>
        <user>
            <userId>2</userId>
            <userLogin>TiTi</userLogin>
            <userPassword>black</userPassword>
            <userName>Le Morzadec</userName>
            <userFirstName>Steven</userFirstName>
            <userMail>slemorza@gmail.com</userMail>
            <userAdmin>true</userAdmin>
        </user>
        <user>
            <userId>3</userId>
            <userLogin>MickOM</userLogin>
            <userPassword>auchiotlarbitre</userPassword>
            <userName>Bride</userName>
            <userFirstName>MickaÃ«l</userFirstName>
            <userMail>mbride@gmail.com</userMail>
            <userAdmin>false</userAdmin>
        </user>
    </mx:XMLList>
    
    <mx:Script>
		<![CDATA[
			import mx.rpc.events.FaultEvent;
			import mx.events.CloseEvent;
			import mx.managers.PopUpManager;
			import mx.messaging.AbstractConsumer;
			import mx.controls.Spacer;
			import mx.containers.ControlBar;
			import mx.containers.Panel;
			import mx.containers.VBox;
			import mx.charts.renderers.DiamondItemRenderer;
			import mx.controls.Alert;
			import org.insia.mdmsCorp.website.as3.Localizator;
			
			[Embed(source='org/insia/mdmsCorp/website/ressources/img/exclamation.png')]
			private var confirmIcon:Class;
			
			/**
			 * Inits the canvas
			 **/
			private function initCanvas():void
			{
				setUserAdminRadioButton();
			}
			
			/**
			 * First state of the form : it initializes the value of the inputText,
			 * turns off buttons and display a confirm popup if we try to insert a new user.
			 **/
			private function buttonsState1():void
			{
				if (backOfficeAddNewButton.label == Localizator.getInstance(1).gT('backOfficeInsertButton'))
				{
					confirmPopup(Localizator.getInstance(1).gT('backOfficePopupConfirmInsertTitle'),Localizator.getInstance(1).gT('backOfficePopupConfirmInsertLabel'), doInsertNewUser);
				}
				backOfficeUpdateButton.enabled = false;
				backOfficeAddNewButton.label = Localizator.getInstance(1).gT('backOfficeInsertButton');
				backOfficeDeleteButton.enabled = false;
				userId.text = "";
				userLogin.text = "";
				userPassword.text = "";
				userName.text = "";
				userFirstName.text = "";
				userMail.text = "";
				userRadioButton.selected = true;
				backOfficeUsersCanvasDataGrid.selectedIndex = -1;
			} 
			
			/**
			 * Second state of the form : it turns on buttons.
			 **/
			private function buttonsState2():void
			{
				backOfficeUpdateButton.enabled = true;
				backOfficeAddNewButton.label = Localizator.getInstance(1).gT('backOfficeAddNewButton');
				backOfficeDeleteButton.enabled = true;
				setUserAdminRadioButton();
			}
			
			/**
			 * Sets the value of the radio button (admin or user)
			 **/
			private function setUserAdminRadioButton():void
			{
				if (backOfficeUsersCanvasDataGrid.selectedItem.userAdmin == "true")
				{
					adminRadioButton.selected = true;
				}
				else
				{
					userRadioButton.selected = true;
				}
			}
			
			/**
			 * Calls the webservice to update the user.
			 **/
			private function doUpdateUser(event:CloseEvent):void
			{
				if (event.detail == Alert.YES) 
				{
					Alert.show("youpie");
				}
			}
			
			/**
			 * Calls the webservice to insert a new user.
			 **/
			private function doInsertNewUser():void
			{
				
			}
			
			/**
			 * Calls the webservice to delete the user.
			 **/
			private function doDeleteUser():void
			{
				
			}
			
			/**
			 * Displays a confirming popup.
			 * 
			 * @param popupTitle String popup title
			 * @param popupLabel String popup label
			 * @param handler Function which is call after confirming the popup
			 * 
			 **/ 
			private function confirmPopup(popupTitle:String, popupLabel:String, handler:Function):void 
			{
				var a:Alert = Alert.show(popupLabel, popupTitle, Alert.YES|Alert.NO, this, handler, confirmIcon, Alert.NO);
			}
			
			/**
			 * Displays a message if the httpservice failed.
			 * 
			 * @param event FaultEvent
			 * @param httpService String
			 **/
			private function faultHandler(event:FaultEvent, httpService:String):void
			{
				Alert.show("HttpService " + httpService + " Failed : " + event.message);	
			}
			
		]]>
	</mx:Script>

    <mx:Panel title="{Localizator.getInstance(1).gT('backOfficeUsersCanvasLabel')}" >
		<mx:VBox horizontalAlign="center">
			<mx:HBox>
		        <mx:DataGrid id="backOfficeUsersCanvasDataGrid" rowCount="7" dataProvider="{users}" height="100%" click="{buttonsState2()}">
		            <mx:columns>
		                <mx:DataGridColumn dataField="userId" headerText="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserIdLabel')}"/>
		                <mx:DataGridColumn dataField="userLogin" headerText="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserLoginLabel')}"/>
		                <mx:DataGridColumn dataField="userAdmin" headerText="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserAdminLabel')}"/>		               
		                <mx:DataGridColumn dataField="userPassword" headerText="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserPasswordLabel')}" visible="false"/>
		                <mx:DataGridColumn dataField="userName" headerText="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserNameLabel')}" visible="false"/>
		                <mx:DataGridColumn dataField="userFirstName" headerText="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserFirstNameLabel')}" visible="false"/>
		                <mx:DataGridColumn dataField="userMail" headerText="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserMailLabel')}" visible="false"/>
		            </mx:columns>
		        </mx:DataGrid>
		        <mx:Form>
		            <mx:FormItem label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserIdLabel')}">
		                <mx:Label id="userId" text="{backOfficeUsersCanvasDataGrid.selectedItem.userId}"/>
		            </mx:FormItem>
		            <mx:FormItem label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserLoginLabel')}">
		                <mx:TextInput id="userLogin" text="{backOfficeUsersCanvasDataGrid.selectedItem.userLogin}"/>
		            </mx:FormItem>
		            <mx:FormItem label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserPasswordLabel')}">
		                <mx:TextInput id="userPassword" displayAsPassword="true" text="{backOfficeUsersCanvasDataGrid.selectedItem.userPassword}"/>
		            </mx:FormItem>
		            <mx:FormItem label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserNameLabel')}">
		                <mx:TextInput id="userName" text="{backOfficeUsersCanvasDataGrid.selectedItem.userName}"/>
		            </mx:FormItem>
		            <mx:FormItem label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserFirstNameLabel')}">
		                <mx:TextInput id="userFirstName" text="{backOfficeUsersCanvasDataGrid.selectedItem.userFirstName}"/>
		            </mx:FormItem>
		            <mx:FormItem label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserMailLabel')}">
		                <mx:TextInput id="userMail" text="{backOfficeUsersCanvasDataGrid.selectedItem.userMail}"/>
		            </mx:FormItem>
		            <mx:FormItem label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasUserAdminLabel')}">
						<mx:RadioButtonGroup id="userAdminRadioButtonGroup" />
		                <mx:HBox>
		                	<mx:RadioButton groupName="userAdminRadioButtonGroup" id="userRadioButton" label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasSimpleUserLabel')}" />
		                	<mx:RadioButton groupName="userAdminRadioButtonGroup" id="adminRadioButton" label="{Localizator.getInstance(1).gT('backOfficeUsersCanvasAdminUserLabel')}" />  			
		                </mx:HBox>
		            </mx:FormItem>
		        </mx:Form>
	        </mx:HBox>
	        <mx:HBox>
	        	<mx:Button id="backOfficeUpdateButton" label="{Localizator.getInstance(1).gT('backOfficeUpdateButton')}" enabled="false" 
	        		click="confirmPopup(Localizator.getInstance(1).gT('backOfficePopupComfirmUpdateTitle'),Localizator.getInstance(1).gT('backOfficePopupComfirmUpdateLabel'), doUpdateUser)"/>
	        	<mx:Button id="backOfficeAddNewButton" label="{Localizator.getInstance(1).gT('backOfficeAddNewButton')}" click="{buttonsState1()}"/>
	        	<mx:Button id="backOfficeDeleteButton" label="{Localizator.getInstance(1).gT('backOfficeDeleteButton')}" enabled="false"
	        		click="confirmPopup(Localizator.getInstance(1).gT('backOfficePopupConfirmDeleteTitle'),Localizator.getInstance(1).gT('backOfficePopupConfirmDeleteLabel'), doDeleteUser)"/>
	        </mx:HBox>
		</mx:VBox>
    </mx:Panel>

    <mx:StringValidator source="{userLogin}" property="text" minLength="4" maxLength="16"/>
 	<mx:StringValidator source="{userPassword}" property="text" minLength="4" maxLength="16"/>
    <mx:EmailValidator source="{userMail}" property="text"/>
	
</mx:Canvas>